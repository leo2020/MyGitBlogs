

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>codepiao</title>
    
    
    <meta name="author" content="codepiano">

    <!-- Enable responsive viewport -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
    <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le styles -->
    <link href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.no-icons.min.css" rel="stylesheet">
    <link href="//netdna.bootstrapcdn.com/font-awesome/3.2.1/css/font-awesome.css" rel="stylesheet">
    <link href="/css/typo.css" rel="stylesheet">
    <link href="/css/style.css?body=1" rel="stylesheet" type="text/css" media="all">
    <link href="/css/solarized.css" rel="stylesheet" type="text/css" media="all">
    <link href="/css/datatables-bootstrap.css" rel="stylesheet">
    <link href="/css/codepiano.css" rel="stylesheet">

    <!-- javascript files -->
    <script type="text/javascript" src="/js/jquery-2.0.0.min.js"></script>
    <script src="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="/js/jquery.dataTables.min.js"></script>
    <script type="text/javascript" src="/js/datatables-bootstrap.js"></script>
    <script type="text/javascript" src="/js/codepiano.js"></script>

    <!-- Le fav and touch icons -->
    <!-- Update these with your own images
    <link rel="shortcut icon" href="images/favicon.ico">
    <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
    -->

    <!-- atom & rss feed -->
    <link href="/atom.xml" type="application/atom+xml" rel="alternate" title="Sitewide ATOM Feed">
    <link href="/rss.xml" type="application/rss+xml" rel="alternate" title="Sitewide RSS Feed">

    <script type="text/javascript">
    </script>

  </head>

  <body id="scroll-pane" data-spy="scroll" data-target="#time-list-nav">
    <div class="wrapper">
      <!-- 导航条 -->
      <div class="navbar">
        <div class="navbar-inner row-fluid">
          <div class="span2">
          </div>
          <div class="span8">
            <a class="brand" href="/">
              <span class="site-author"> codepiano </span>
              <span class="site-title"> /* 隐匿于黑夜中的星 */ </span>
            </a>
            <ul class="nav">
              
              
              





<li class="posts"><a href="/posts.html">文章</a></li>
<li class="timeline"><a href="/timeline.html">归档</a></li>
<li class="categories"><a href="/categories.html">目录</a></li>
<li class="about"><a href="/about.html">关于</a></li>

            </ul>
          </div>
          <div class="span2">
          </div>
        </div>
      </div>

      <!-- 正文 -->
      

<div class="row-fluid typo">
  <div class="span2">
    <ul class="nav nav-tabs nav-stacked dispear" id="support">
      <li><a href="#" onclick="toggleSupport();return false;"><i class="icon-star-empty"></i> 技术支持</a></li>
      <li><a data-toggle="tooltip" title data-original-title="为 Twitter Bootstrap 设计的图标字体" href="http://fontawesome.io" target="_blank"><i class="icon-ok"></i> Font-Awesome</a></li>
      <li><a data-toggle="tooltip" title data-original-title="github提供的免费静态页面服务，使用git进行发布和管理" href="http://pages.github.com" target="_blank"><i class="icon-ok"></i> Github Pages</a></li>
      <li><a data-toggle="tooltip" title data-original-title="静态页面生成工具" href="http://jekyllrb.com" target="_blank"><i class="icon-ok"></i> Jekyll</a></li>
      <li><a data-toggle="tooltip" title data-original-title="博客页面模板" href="http://jekyllbootstrap.com" target="_blank"><i class="icon-ok"></i> Jekyll-Bootstrap</a></li>
      <li><a data-toggle="tooltip" title data-original-title="Javascript框架" href="http://jquery.com" target="_blank"><i class="icon-ok"></i> JQuery</a></li>
      <li><a data-toggle="tooltip" title data-original-title="基于JQuery的表格插件" href="http://www.datatables.net/" target="_blank"><i class="icon-ok"></i> DataTables</a></li>
      <li><a data-toggle="tooltip" title data-original-title="Twitter提供的前端框架" href="http://twitter.github.io/bootstrap" target="_blank"><i class="icon-ok"></i> Twitter Bootstrap</a></li>
      <li><a data-toggle="tooltip" title data-original-title="排版样式表" href="http://typo.sofish.de" target="_blank"><i class="icon-ok"></i> Typo.css</a></li>
      <li><a data-toggle="tooltip" title data-original-title="开发工具" href="http://www.vim.org" target="_blank"><i class="icon-ok"></i> Vim</a></li>
    </ul>
  </div>
  <div class="span8">
    

<!-- 按照分页插入博客文章 -->

  <h2 class="title"><a href="/Vim/Vim Plugin/2013/08/12/vim-surround">vim插件surround介绍</a></h2>
  <div class="post_info">
  
  <ul class="tag_box inline">
    <li><i class="icon-calendar"></i></li>
    <li id="post-date"> 2013 年 08 月 12 日</li>
    <li><i class="icon-folder-open"></i></li>
    
    
 
  <li>
    <a href="/categories.html#Vim-ref">
      Vim 
    </a>
  </li>
  
  <li>
    <i class="icon-double-angle-right"></i>
  </li>
  
 
  <li>
    <a href="/categories.html#Vim Plugin-ref">
      Vim Plugin 
    </a>
  </li>
  



  </ul>
  
  <span>
  </div>
  <div class="archive">
    

<h3>插件作者</h3>
<p class="paragraph">
vim-surround是一个处理成对出现的“包围结构”的插件，比如处理括号、引号和html标签。对文本的外包的结构进行增加、修改和删除。
由于插件提供的命令接受vim文本对象和vim的移动命令，使用起来比较方便，额外的学习成本比较低。
插件的github地址为：<a href="https://github.com/tpope/vim-surround">tpope/vim-surround · GitHub</a>
<br />
作者是<a href="http://tpo.pe/">tpope</a>，tpope贡献了很多实用的vim插件，他的github：<a href="https://github.com/tpope">tpope (Tim Pope) · GitHub</a>
</p>
<h3>普通模式命令</h3>
普通模式下，插件提供下列按键绑定：
<ul class="nav nav-tabs nav-stacked">
  <li><a href="#cs">cs 改变外部包围对象</a></li>
  <li><a href="#ds">ds 删除外部包围对象</a></li>
  <li><a href="#ys">ys 使用指定的符号包裹文本对象</a></li>
</ul>
<h4 id="cs">替换：change surround</h4>
<p class="paragraph">
cs命令是change surround的缩写，可以对指定的文本的外部包围字符进行替换，命令接受两个参数：
第一个是被替换的外部包围字符，第二个是要替换为的字符。替换时光标需要移动到被包围的文本内。
比如需要将字符串'test'外部的包围字符'替换为"，可以将光标移动到文本区域内，然后使用cs'"即可
下面是一些例子，部分来自帮助文件，其中的*号代表光标位置
<br />
<span class="label label-important">注意</span> 命令中使用形如()、{}、[]的字符的左半部分和右半部分是有区别的，
区别在于处理中的头部和尾部的空格的处理，考虑例子6、7、8、9的情况，处理字符串(&nbsp;&nbsp;&nbsp;test &nbsp;&nbsp;)，
字符串有3个头部空格，有2个尾部空格。
<br />
<span class="label label-success">规则</span> 规则可以总结如下：
<br />
1.第一个参数使用符号的左半部分，会自动删除所有的头部和尾部 的空格，使用右半部分则不对空格进行处理
<br />
2.第二个参数使用符号的左半部分，会自动在左半部分的后面和右半部分的前面插入一个空格
<br />
注意例子8中的空格个数，被自动插入了空格
</p>
<table class="table table-striped table-bordered">
  <thead>
    <tr>
      <td>样例序号</td>
      <td>原始文本</td>
      <td>执行命令</td>
      <td>执行结果</td>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>1</td>
      <td>"Hello*world!"</td>
      <td>cs"'</td>
      <td>'Helloworld!'</td>
    </tr>
    <tr>
      <td>2</td>
      <td>"Hello*world!"</td>
      <td>cs"&lt;q&gt;</td>
      <td>&lt;q&gt;Helloworld!&lt;/q&gt;</td>
    </tr>
    <tr>
      <td>3</td>
      <td>(( Hello*world! ))</td>
      <td>cs(*</td>
      <td>(*Hello*world!*)</td>
    </tr>
    <tr>
      <td>4</td>
      <td>(( Hello*world! ))</td>
      <td>cs( *</td>
      <td>(* Hello*world! *)</td>
    </tr>
    <tr>
      <td>5</td>
      <td>&lt;div&gt;Yo!*&lt;/div&gt;</td>
      <td>cst&lt;p&gt;</td>
      <td>&lt;p&gt;Yo!&lt;/p&gt;</td>
    </tr>
    <tr>
      <td>6</td>
      <td>(&nbsp;&nbsp;&nbsp;test &nbsp;&nbsp;)</td>
      <td>cs([</td>
      <td>[ test ]</td>
    </tr>
    <tr>
      <td>7</td>
      <td>(&nbsp;&nbsp;&nbsp;test &nbsp;&nbsp;)</td>
      <td>cs(]</td>
      <td>[test]</td>
    </tr>
    <tr>
      <td>8</td>
      <td>(&nbsp;&nbsp;&nbsp;test &nbsp;&nbsp;)</td>
      <td>cs)[</td>
      <td>[&nbsp;&nbsp;&nbsp;&nbsp;test &nbsp;&nbsp;&nbsp;]</td>
    </tr>
    <tr>
      <td>9</td>
      <td>(&nbsp;&nbsp;&nbsp;test &nbsp;&nbsp;)</td>
      <td>cs)]</td>
      <td>[&nbsp;&nbsp;&nbsp;test &nbsp;&nbsp;]</td>
    </tr>
  </tbody>
</table>
<h4 id="ds">删除：delete surround</h4>
<p class="paragraph">
ds命令是delete surround的缩写，该命令只接受一个参数，即为需要删除的外部包围字符
如果需要删除文本外部的标签，可以使用字符t来指代标签，不需要输入标签全称
下面是一些例子：
<br />
<span class="label label-important">注意</span> 命令中使用形如()、{}、[]的字符的左半部分和右半部分是有区别的，
规则同cs命令的规则1，即同样遵守第一个参数的规则，不再举例示范
</p>
<table class="table table-striped table-bordered">
  <thead>
    <tr>
      <td>样例序号</td>
      <td>原始文本</td>
      <td>执行命令</td>
      <td>执行结果</td>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>1</td>
      <td>"Hello*world!"</td>
      <td>ds"</td>
      <td>Hello world!</td>
    </tr>
    <tr>
      <td>2</td>
      <td>((Hello*world!))</td>
      <td>ds{</td>
      <td>(Hello*world!)</td>
    </tr>
    <tr>
      <td>2</td>
      <td>(123+4*56)/2</td>
      <td>ds)</td>
      <td>123+456/2</td>
    </tr>
    <tr>
      <td>3</td>
      <td>&lt;div&gt;Yo!*&lt;/div&gt;</td>
      <td>dst</td>
      <td>Yo!</td>
    </tr>
  </tbody>
</table>
<h4 id="ys">添加：you surround</h4>
<p class="paragraph">
ys命令是you surround（按作者的说法），可以对指定的文本进行包围，命令接受两个参数：
第一个是指示文本范围或者移动位置的文本对象，第二个是包围操作使用的字符。插入时光标需要移动到被包围的文本内。
比如需要将字符串test添加外部包围字符'，可以将光标移动到文本区域内，然后使用ysaw"即可，其中aw会被当作vim文本对象，
ys模式有一种变形，即yss和ySS，操作的对象是当前行，不过yss的包围符号添加在行首行尾，而ySS的符号会插入两个新行来包围。
下面是一些例子，部分来自帮助文件，其中的*号代表光标位置
<br />
指定范围的两种方法
<br />
1.文本对象，规则基本同vim的文本对象规则一样
<br />
2.移动位置，可以使用^、$、f等命令来指定位置，作用范围是当前光标到指定的位置
<br />
<span class="label label-important">注意</span> 命令中使用形如()、{}、[]的字符的左半部分和右半部分是有区别的，
规则同cs命令的规则2，即同样遵守第二个参数的规则，不再举例示范
</p>
<table class="table table-striped table-bordered">
  <thead>
    <tr>
      <td>样例序号</td>
      <td>原始文本</td>
      <td>执行命令</td>
      <td>执行结果</td>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>1</td>
      <td>test</td>
      <td>ysiw'</td>
      <td>'test'</td>
    </tr>
    <tr>
      <td>2</td>
      <td>'test'</td>
      <td>ysi')</td>
      <td>'(test)'</td>
    </tr>
    <tr>
      <td>3</td>
      <td>'test'</td>
      <td>ysa')</td>
      <td>('test')</td>
    </tr>
    <tr>
      <td>4</td>
      <td>foo*testbar</td>
      <td>ystb)</td>
      <td>foo(test)bar</td>
    </tr>
    <tr>
      <td>5</td>
      <td>test</td>
      <td>ysaw&lt;p class="example"&gt;</td>
      <td>&lt;p class="example"&gt;test&lt;/p&gt;</td>
    </tr>
  </tbody>
</table>
<h3>可视模式命令</h3>
<p class="paragraph">
可视模式下可以选择需要的文本块，然后使用命令S，就可以输入用来进行包围的字符，不再赘述。
</p>
<h3>插入模式命令</h3>
<p class="paragraph">
插件的插入模式还处于试验状态，可以在插入模式下插入字符对，不过我并没有测试成功。通过map命令查看文档中的按键绑定，发现并未绑定函数。
</p>
<h3>定制插件行为</h3>
<p class="paragraph">
插件提供对符号的行为进行定制的功能，如果需要定制'-'符号在php文件中的功能，则按下面步骤操作
</p>
<div class="highlight"><pre><code class="vim"><span class="c">&quot; 1.使用vim函数获得ascii码</span>
<span class="p">:</span>echo char2nr<span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">)</span>
<span class="c">&quot; 2.在vim文件中添加绑定，并使用文件类型侦测</span>
<span class="c">&quot; 注意b:surround_45使用了&#39;-&#39;的ascii码值45</span>
autocmd <span class="nb">FileType</span> php <span class="k">let</span> <span class="k">b</span>:surround_45 <span class="p">=</span> <span class="s2">&quot;&lt;?php \r ?&gt;&quot;</span>
</code></pre>
</div>

<p class="paragraph">
如果文件类型是php，则在字符串 print "Hello *world!"上执行yss-即可得到&lt;?php print "Hello world!" ?&gt;。使用如下方式还可以请求用户输入，jekyll的语法高亮使用highlight语法来完成，每次输入较麻烦，可以在vimrc中加入下面的设置
</p>

<div class="highlight"><pre><code class="vim"><span class="k">let</span> <span class="k">g</span>:surround_45 <span class="p">=</span> <span class="s2">&quot;{% hightlight \1代码语言: \1 %}\r{% endhighlight %}&quot;</span>
</code></pre>
</div>


<p class="paragraph">
这样就自定义了字符"-"的包围语法模板，比如在testtest上使用ySS-，会显示“代码语言：”并等待用户输入，输入bash，则得到下面的代码
其中的"\1代码语言: \1"被替换为用户输入的字符串，"\r"被替换为用户选择的需要被包围的文本，其余的均原样输出，
如果需要，可以在语法模板中使用换行等转义字符。语法模板也支持正则表达式的处理，但是语法过于古怪和丑陋，个人认为没有使用的价值。
</p>
<div class="highlight">
  <pre>
{% highlight bash %}
testtest
{% endhighlight %}
  </pre>
</div>

  </div>
  <hr />
  
  <h2 class="title"><a href="/Git/2013/07/03/push-multi-remote-repositories">推送git项目到多个远程仓库</a></h2>
  <div class="post_info">
  
  <ul class="tag_box inline">
    <li><i class="icon-calendar"></i></li>
    <li id="post-date"> 2013 年 07 月 03 日</li>
    <li><i class="icon-folder-open"></i></li>
    
    
 
  <li>
    <a href="/categories.html#Git-ref">
      Git 
    </a>
  </li>
  



  </ul>
  
  <span>
  </div>
  <div class="archive">
    

<p class="paragraph">
最近<a href="http://www.oschina.net/">开源中国 - 找到您想要的开源项目，分享和交流</a>也推出了git项目托管服务，
想把部分github中的项目同步到git@osc，在网上搜索了一下，找到了一种比较简单的同步办法，方法分享在下面。
</p>
<p class="paragraph">
首先强烈推荐实用ssh的方式来完成push过程中的认证，这样不用每次都输入用户名和密码，十分方便。具体方式可以参考github的
官方教程<a href="https://help.github.com/articles/generating-ssh-key">GitHub Help</a>
</p>
<p class="paragraph">
如果已经配置好了ssh验证方式，在开源中国的git托管也可以使用同一个的key，然后打开github项目中中的.git/config文件
在[remote "origin"]节点的原始url下面直接添加开源中国git中对应项目的ssh地址即可，例如：
</p>
<div class="highlight">
<pre>
[remote "origin"]
	url = git@github.com:codepiano/pull-all-git-project.git
	url = git@git.oschina.net:codepiano/pull-all-git-project.git
	fetch = +refs/heads/*:refs/remotes/origin/*
</pre>
</div>
<p class="paragraph">
当然，使用命令行也可以直接添加，命令格式如下：
</p>
<div class="highlight"><pre><code class="bash">git remote <span class="nb">set</span>-url --add origin git@git.oschina.net:codepiano/pull-all-git-project.git
</code></pre>
</div>



  </div>
  <hr />
  
  <h2 class="title"><a href="/Vim/Vimscript/2013/05/27/bug-trace-of-vim-zencoding-plugin">vim zencoding插件的一个bug的跟踪和解决过程</a></h2>
  <div class="post_info">
  
  <ul class="tag_box inline">
    <li><i class="icon-calendar"></i></li>
    <li id="post-date"> 2013 年 05 月 27 日</li>
    <li><i class="icon-folder-open"></i></li>
    
    
 
  <li>
    <a href="/categories.html#Vim-ref">
      Vim 
    </a>
  </li>
  
  <li>
    <i class="icon-double-angle-right"></i>
  </li>
  
 
  <li>
    <a href="/categories.html#Vimscript-ref">
      Vimscript 
    </a>
  </li>
  



  </ul>
  
  <span>
  </div>
  <div class="archive">
    


<p class="paragraph">
前几天用vim写博客的过程中发现一个bug，当使用&lt;c-y&gt;a自动生成a标签的时候，会丢失href元素，
就跟踪了下那个函数的调用过程。找着bug的原因后，在github上给zencoding的作者发了一个pull request，
不过由于作者想更深层修复缺陷，没有merge，给转成issue了。把具体的跟踪过程和分析记录在这里
</p>
<p class="paragraph">
&lt;c-y&gt;a是个很好用的命令，比如你准备插入一个a标签，只用输入http://www.vim.org，
然后使用zencoding扩展，会自动生成a标签，插件会联网读取那个网址的title标签，
并使用标签内容作为a标签的显示内容:
</p>
<div class="highlight"><pre><code class="html"><span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;http://www.vim.org&quot;</span><span class="nt">&gt;</span>welcome home : vim online<span class="nt">&lt;/a&gt;</span>
</code></pre>
</div>

<p class="paragraph">
不过我使用的时候遇到一个bug，生成的a标签会丢失href属性，想寻找bug出现的原因就要跟踪代码调用过程。
使用&lt;c-y&gt;a标签的时候在vim状态栏可以看到调用了zencoding#anchorizeURL函数，并传入了一个参数，
值为0。而zencoding插件的初始化操作在plugin/zencoding.vim文件中，顶层函数放在autoload/zencoding.vim中，
具体的处理标签的底层操作逻辑分散放在autoload/zencoding目录中。先从autoload/zencoding.vim入手，
找到了zencoding#anchorizeURL函数，通过阅读代码找到如下逻辑：
</p>
<div class="highlight"><pre><code class="vim"><span class="c">&quot; file:autoload/zencoding.vim</span>

<span class="c">&quot; a:flag即为传入的参数，当调用&lt;c-y&gt;a时为0，调用&lt;c-y&gt;A时为1</span>
<span class="k">if</span> <span class="k">a</span>:flag <span class="p">==</span> <span class="m">0</span>
<span class="c">  &quot; 生成a标签的属性字典</span>
  <span class="k">let</span> <span class="k">a</span> <span class="p">=</span> zencoding#<span class="k">lang</span>#html#parseTag<span class="p">(</span><span class="s1">&#39;&lt;a&gt;&#39;</span><span class="p">)</span>
  <span class="k">let</span> <span class="k">a</span>.attr.href <span class="p">=</span> url
  <span class="k">let</span> <span class="k">a</span>.value <span class="p">=</span> <span class="s1">&#39;{&#39;</span> . <span class="nb">title</span> . <span class="s1">&#39;}&#39;</span>
<span class="c">  &quot; 根据属性字典生成html代码</span>
  <span class="k">let</span> expand <span class="p">=</span> zencoding#toString<span class="p">(</span><span class="k">a</span><span class="p">,</span> rtype<span class="p">,</span> <span class="m">0</span><span class="p">,</span> []<span class="p">)</span>
<span class="c">  &quot; 去除代表光标位置的标志符号</span>
  <span class="k">let</span> expand <span class="p">=</span> substitute<span class="p">(</span>expand<span class="p">,</span> <span class="s1">&#39;\${cursor}&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;g&#39;</span><span class="p">)</span>
<span class="k">else</span>
<span class="c">  &quot; ...</span>
<span class="k">endif</span>
</code></pre>
</div>

<p class="paragraph">
通过分析上面这段代码，可以知道问题应该处在zencoding#toString函数中，不过通过分析该函数的代码，
发现这个函数只是一个顶层函数，根据上步调用传入的属性字典的name或者snippts属性来决定是调用底层工具函数来生成代码，
还是通过自定义snippts进行扩展。结合传入参数和程序逻辑，在这个功能中，是调用了底层工具函数zencoding#lang#html#toString，
该函数位于autoload/zencoding/lang/html.vim中。函数中有下面这段代码
</p>
<div class="highlight"><pre><code class="vim"><span class="c">&quot; file:autoload/zencoding/lang/html.vim</span>

<span class="k">if</span> len<span class="p">(</span>current_name<span class="p">)</span> <span class="p">&gt;</span> <span class="m">0</span>
  <span class="k">let</span> str .<span class="p">=</span> <span class="s1">&#39;&lt;&#39;</span> . current_name
  <span class="k">for</span> attr <span class="k">in</span> zencoding#util#unique<span class="p">(</span>current.attrs_order<span class="p">)</span>
    <span class="k">if</span> <span class="p">!</span>has_key<span class="p">(</span>current.attr<span class="p">,</span> attr<span class="p">)</span>
      continue
    <span class="k">endif</span>
<span class="c">    &quot; ...</span>
  <span class="k">endfor</span>
<span class="c">  &quot; ...</span>
<span class="k">endif</span>
</code></pre>
</div>

<p class="paragraph">
出现href属性丢失的原因是因为current.attrs_order为空，没有'href'属性名字符串，
所以生成的标签也不存在href属性。
也就是说由于程序缺陷，导致属性字典中代表标签属性列表的数组attrs_order为空。
由于我并没有深层次的去读插件的源码，所以不了解这个数组为空的原因，
而autoload/zencoding.vim中的zencoding#anchorizeURL函数只处理a标签的扩展，
所以我直接在顶层函数zencoding#anchorizeURL中给attrs_order中add了一个值'href'，
这样可以解决这一个小问题。后来给插件作者发了pull request，说明了bug的原因，
并指出不确定是不是最好的解决方式，插件作者回复说他想从本质上解决这个问题，
把我的pull request转成了issue。一开始我以为作者会去解决attrs_order数组为空的问题，
不过pull最新的代码，发现作者也没去修改attrs_order数组，而是在底层的工具函数上打了个补丁，
修改后的代码如下
</p>
<div class="highlight"><pre><code class="vim"><span class="c">&quot; file:autoload/zencoding/lang/html.vim</span>

<span class="k">if</span> len<span class="p">(</span>current_name<span class="p">)</span> <span class="p">&gt;</span> <span class="m">0</span>
  <span class="k">let</span> str .<span class="p">=</span> <span class="s1">&#39;&lt;&#39;</span> . current_name
<span class="c">  &quot; 打了个keys(current.attr)的补丁，补全了属性</span>
  <span class="k">for</span> attr <span class="k">in</span> zencoding#util#unique<span class="p">(</span>current.attrs_order <span class="p">+</span> keys<span class="p">(</span>current.attr<span class="p">))</span>
    <span class="k">let</span> val <span class="p">=</span> current.attr[attr]
<span class="c">    &quot; ...</span>
  <span class="k">endfor</span>
<span class="c">  &quot; ...</span>
<span class="k">endif</span>
</code></pre>
</div>

<p class="paragraph">
关于这次的bug修改，让我想起看过的伞哥 <a href="http://weibo.com/tianchunbinghe">@田春冰河</a> 的一条微博说过的一种情况，
微博找不到了，大意是说：一个工具模块的代码缺陷A，导致不同的功能中出现bug的并集U，
测试人员通过测试发现其中一个子集u，然后开发人员修复子集u中的bug，
而真正好的解决方式是通过bug集u找到问题的源头，即缺陷A，从而修复整个bug集U。
这次的情况也类似，我只修复了a标签生成这一个bug，作者修改底层模块后也修复了潜在的其他bug
</p>

  </div>
  <hr />
  
  <h2 class="title"><a href="/Vim/Vimscript/2013/05/06/vim-plugin-generate-table-border-with-symbol">生成表格边框的vim插件</a></h2>
  <div class="post_info">
  
  <ul class="tag_box inline">
    <li><i class="icon-calendar"></i></li>
    <li id="post-date"> 2013 年 05 月 06 日</li>
    <li><i class="icon-folder-open"></i></li>
    
    
 
  <li>
    <a href="/categories.html#Vim-ref">
      Vim 
    </a>
  </li>
  
  <li>
    <i class="icon-double-angle-right"></i>
  </li>
  
 
  <li>
    <a href="/categories.html#Vimscript-ref">
      Vimscript 
    </a>
  </li>
  



  </ul>
  
  <span>
  </div>
  <div class="archive">
    

<p class="paragraph">
vim插件，惟一用途是在文本文件中来展示表格，使用字符来模拟表格的边框。会破坏原始数据，不便于复制，
请谨慎使用。由于字符的展示方式与字体有关，可能某些字体下边框不能完美的对齐。
项目地址:<a href="https://github.com/codepiano/TableKnight">codepiano/TableKnight · GitHub</a>
</p>
<p class="paragraph">
插件会根据分隔符自动分割选定的文本行，然后插入边框字符。例如：下面的字符
</p>
<div class="highlight">
<pre>
1|2
|1|2|||3
1|2|3|4|5
</pre>
会生成：
<pre>
+===========+
|1|2| | | | |
|-+-+-+-+-+-|
| |1|2| | |3|
|-+-+-+-+-+-|
|1|2|3|4|5| |
+===========+
</pre>
</div>
<p class="paragraph">
插件提供了边框和分割符的自定义机制，具体请参考README
</p>


  </div>
  <hr />
  

  <!-- 分页页码展示 -->
  <div id="post-pagination" class="pagination pagination-centered">
    <ul>
      <!-- 上一页按钮 -->
      
      <li class="disabled">
      <span><i class="icon-chevron-left"></i></span>
      </li>
      

      <!-- 第一页,访问根目录 -->
      
      <li class="active">
      <a href="#">1</a>
      </li>
      

      
      
      <li>
      <a href="/page2">2</a>
      </li>
      
      
      
      <li>
      <a href="/page3">3</a>
      </li>
      
      

      
      <li>
      <a href="/page2"><i class="icon-chevron-right"></i></a>
      </li>
      
    </ul>
  </div>


  </div>
  <div class="span2">
  </div>
</div>



    </div>
    <!-- 底部声明 -->
    <div class="row-fluid bottom">
      <div class="span2">
      </div>
      <div class="span8 text-center">
        &mdash;&nbsp;&nbsp;<a href="http://creativecommons.org/licenses/by-nc-nd/3.0/deed.zh" class="license">原创作品许可 &mdash; 署名-非商业性使用-禁止演绎 3.0 未本地化版本 &mdash; CC BY-NC-ND 3.0 </a>&nbsp;&nbsp;&mdash;
      </div>
      <div class="span2">
      </div>
    </div>

    


  <script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-40934298-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>





  </body>
</html>

